

[TOC]

# C基础知识

## 标识符1

``` c
extern	声明变量是在其他文件正声明
typedef	用以给数据类型取别名
auto	声明自动变量
static	声明静态变量int声明整型变量或函数
const	声明只读变量
volatile	说明变量在程序执行中可被隐含地改变long声明长整型变量或函数
register	声明寄存器变量
```
### extern

- Q&A: **extern "C"**的作用
  - 是告诉**C++编译器**用C规则编译指定的代码（除函数重载外，**extern “C”**不影响C++其他特性）

### typedef

- 常规用法

  - ```c
    typedef char* PCHAR1;
    typedef struct Books
    {
       char  title[50];
       char  author[50];
       char  subject[100];
       int   book_id;
    }Book;
    typedef int (*fun_ptr)(int,int); // 声明一个指向同样参数、返回值的函数指针类型
    ```

- Q&A: **typedef**和**#define**

  - **#define** 是 C 指令，用于为各种数据类型定义别名，也能为数值定义别名

  - **typedef** 仅限于为类型定义符号名称

  - **typedef** 是由编译器执行处理的，**#define** 语句是由预编译器进行处理的。

  - **typedef作用域**

    - 如果放在所有函数之外，它的作用域就是从**它定义开始直到文件尾**
    - 如果放在某个函数内，它的作用域就是从**它定义开始直到该函数结尾**

  - **#define作用域**

    - 不管是在某个函数内，还是在所有函数之外，作用域都是从定义开始直到整个文件结尾（不管是typedef还是define，其作用域都不会扩展到别的文件，即使是同一个程序的不同文件，也不能互相使用）

  - ```c
    typedef char* PCHAR1;
    #define PCHAR2 char *
    
    PCHAR1 c1,c2;//c1和c2都是指针
    PCHAR2 c3,c4;//c3是指针，c4不是指针
    ```

### auto

- 动态存储，如果不赋初值，将是一个不确定的值。

### static

- 修饰全局变量
  - **静态全局变量**（存放在数据段(.data段/.bss段)）仅对当前文件可见，其他文件不可访问，其他文件可定义相同变量名，两者互不影响

- 修饰局部变量
  - **静态局部变量**（存放在数据段(.data段/.bss段)）初始化为0，运行一开始开辟内存，内存放在全局，增加了变量的存活时间与函数的堆栈区不在同一个区域，因此函数运行完毕后静态局部变量不会被释放。
  - **静态局部变量**只赋一次初值。下次使用静态局部变量的时候直接使用上次保存下来的值而不会重新赋值。

- 修饰函数
  - **静态函数**只能在声明它的文件中可见，其他文件不能引用该函数，其他文件函数名可相同，是对函数本身的一种保护机制。
- 头文件中定义静态变量
  - 含该头文件的源文件会有命名相同但实际不同的静态变量

### const

- 修饰普通变量

  ```c
  const int a = 100;int const a = 100;//常量、定义同时必须初始化
  const int MaxNum1 = getNum();  //运行时初始化
  const int MaxNum2 = n;         //运行时初始化
  const int MaxNum3 = 80;        //编译时初始化
  ```

- 修饰指针

  ```c
  //const 离变量名近就是用来修饰指针变量的，离变量名远就是用来修饰指针指向的数据，如果近的和远的都有，那么就同时修饰指针变量以及它指向的数据。
  const int *p;//修饰指针指向的数据只读-----常用来作为形参指针
  int const *p;//修饰指针指向的数据只读
  int * const p;//修饰指针变量
  const int * const p;int const * const p;//两者
  const char **       // 是一个指向指针的指针，那个指针又指向一个字符串常量。   
  char **             // 也是一个指向指针的指针，那个指针又指向一个字符串变量。
  ```

  - 不能将const char *类型的数据赋值给char *类型的变量。但反过来是可以的，编译器允许将char *类型的数据赋值给const char *类型的变量。

- 全局常量（静态存储区）、局部常量（栈）、const修饰的字符串常量（常量存储区）

- Q&A:const + volatile 为只读状态寄存器

### volatile

- 防止被优化（意想不到的改变）优化器在用到这个变量时必须每次都小心地重新读取这个变量的值,而不是使用保存在寄存器里的备份。

  ```c
  //注意要把常量转换成无符号整形指针的数据类型，一般还要加 volatile 防止被优化
  volatile unsigned int *p = (volatile unsigned int *)0x000051EF;
  printf("p = 0x%p\n", p);
  ```

- 中断服务程序中修改的供其它程序检测的变量需要加volatile，也可以使用关键区保护；

- 多任务环境下各任务间共享的标志应该加volatile，也可以关闭系统调度；

- 存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能有不同意义。

- 理解为直接存取原始内存地址

- Q&A:当一个中服务子程序修该一个指向一个buffer的指针时，buffer应加volatile

### register

- 会优先存储在CPU寄存器中（但不一定会存储在寄存器中，因为寄存器数量是有限的），而且该变量不能使用取地址符(&)

``` c
void	声明函数无返回值或无参数，声明无类型指针float声明浮点型变量或函数
signed	声明有符号类型变量或函数
unsigned	声明无符号类型变量或函数
char	声明字符型变量或函数
short	声明短整型变量或函数
int		声明整型变量或函数
long    声明长整型变量或函数
float	声明单精度变量或函数
double	声明双精度变量或函数
struct	声明结构体变量或函数
union	声明共用数据类型
enum	声明枚举类型
```
### 数据类型

- float和double的存储
  - 1 + 8 + 23、1 + 11 + 52
- Q&A:判断两个浮点数相等（和0做比较）
  - float 6~7位有效数字，double 15~16位有效数字

### struct

- 略

### union

- 共用体占用的内存应足够存储共用体中最大的成员，共用体赋值会导致覆盖。


### enum

- ==第一个枚举成员的默认值为整型的 0，后续枚举成员的值在前一个成员上加 1==。

  ```c
  enum season {spring, summer=3, autumn, winter}; //0 3 4 5
  ```

- ==内存大小一般小于1个int类型数==

``` c
for	一种循环语句do循环语句的循环体
do 
while	循环语句的循环条件
if	条件语句
else	条件语句否定分支（与 if 连用）
switch	用于开关语句
case	开关语句分支
goto	无条件跳转语句
break	结束当前循环，跳出当前循环
continue	结束当前循环，开始下一轮循环
default	开关语句中的其他分支
```
特别说明：

## 基本数据类型

linux系统下的字节数，windows64位下的long(int)和unsigned  long(int)均为4个字节。

| DataType            | 16      | 32      | 64      |
| ------------------- | ------- | ------- | ------- |
| char                | 1个字节 | 1个字节 | 1个字节 |
| short（int）        | 2个字节 | 2个字节 | 2个字节 |
| int                 | 2个字节 | 4个字节 | 4个字节 |
| unsigned int        | 2个字节 | 4个字节 | 4个字节 |
| float               | 4个字节 | 4个字节 | 4个字节 |
| double              | 8个字节 | 8个字节 | 8个字节 |
| long(int)           | 4个字节 | 4个字节 | 8个字节 |
| long long(int)      | 8个字节 | 8个字节 | 8个字节 |
| unsigned  long(int) | 4个字节 | 4个字节 | 8个字节 |
| 指针                | 2个字节 | 4个字节 | 8个字节 |
| 数组                |         |         |         |
| 结构体              |         |         |         |
| 结构体-位域         |         |         |         |
| 联合体              |         |         |         |
| 类                  |         |         |         |

## 作用域

- 代码块作用域：{}

- 文件作用域：文件内部

- 原型作用域：函数原型中声明的参数名
- 函数作用域

## 操作符与表达式

- ==左值和右值==

- ==类型转换==
  - 隐式类型转换
  - 类型强转
- ==优先级和求值顺序和表达式的值==
- ==贪心法==

## 逗号表达式

1. 优先级最低
2. ==从左到右逐个计算==
3. 逗号表达式作为一个整体，==它的值为最后一个表达式的值==
4. `x = (++i, i++, i+10);`      逗号表达式中，i 在遇到每个逗号后，认为本计算单位已经结束，i 这时候自加。
